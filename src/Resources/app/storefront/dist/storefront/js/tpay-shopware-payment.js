"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["tpay-shopware-payment"],{8888:(t,e,i)=>{var s,n,o,a=i(6285),l=i(1966),r=i(3206);class d extends a.Z{init(){this._form=r.Z.querySelector(document,this.options.formSelector),this.formAutoSubmitInstance=PluginManager.getPluginInstanceFromElement(this._form,"FormAutoSubmit"),this.formAutoSubmitInstance.options.changeTriggerSelectors.push(this.options.changeTriggerSelector),this._banks=r.Z.querySelectorAll(this.el,this.options.bankLabelSelector),this._paymentInputPaymentInput=r.Z.querySelector(document,`[name="${this.options.paymentMethodInputName}"][value="${this.options.paymentId}"]`),this._registerEvents()}_registerEvents(){l.Z.iterate(this._banks,(t=>{t.addEventListener("click",this._onBankClick.bind(this))}))}_onBankClick(t){const e=this.el.querySelector("."+this.options.itemActiveClass);t.stopPropagation(),this._paymentInputPaymentInput.checked=!0,e&&e.classList.remove(this.options.itemActiveClass),t.target.parentElement.classList.add(this.options.itemActiveClass)}}s=d,o={bankInputName:"tpayBank",bankLabelSelector:".tpay--list-item-container",formSelector:"#changePaymentForm",paymentMethodInputName:"paymentMethodId",itemActiveClass:"is--active",paymentId:"",changeTriggerSelector:".tpay--bank-input"},(n=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(n="options"))in s?Object.defineProperty(s,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[n]=o;const h=[new RegExp("^[0-9]$"),new RegExp("^[0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9][0-9]$")];class c extends a.Z{init(){this.validateBlik(),this._registerEvents()}_registerEvents(){this.el.addEventListener("keyup",this.validateBlik.bind(this)),this.el.addEventListener("paste",this.validateBlik.bind(this))}validateBlik(){const t=" "===this.el.value[3];let e=this.el.value.length;if(e<0&&(this.el.value=""),e<=7&&e>0){if(e>=4&&!t)return this.el.value=(i=this.el.value,s=" ",n=3,`${i.slice(0,n)}${s}${i.slice(n)}`),void this.validateBlik();for(;e>0&&!h[e-1].test(this.el.value);)this.el.value=this.el.value.slice(0,-1),e=this.el.value.length}else e>=8&&e<=9&&(this.el.value=this.el.value.slice(0,-1));var i,s,n;this.el.value.length>=8&&(this.el.value=this.el.value.slice(0,7-this.el.value.length))}}var u=i(5420),p=i(8254);class m extends a.Z{init(){this._errors=[],this._client=new p.Z,this.checksCount=0,this.totalChecksCount=Math.floor(6e4*this.options.waitingTime/1e4),this._checkOrderPayment(),this._checkPaymentStateInterval(),this._hideChangePaymentFormButton()}_checkPaymentStateInterval(){this.loopInterval=setInterval(this._loop.bind(this),1e4)}_loop(){this._checkOrderPayment(),this.checksCount===this.totalChecksCount&&(clearInterval(this.loopInterval),this._changeButtonText(this.options.waitingFailText),this._changeLocation(this.options.failUrl))}_checkOrderPayment(){this.checksCount++,this._client.post(this.options.checkUrl,JSON.stringify({transactionId:this.options.transactionId}),this._showPaymentState.bind(this))}_showPaymentState(t){let e=JSON.parse(t);e.success?(this._changeButtonText(this.options.waitingSuccessText),this._changeLocation(this.options.successUrl)):e.waiting||(this._changeButtonText(this.options.waitingFailText),this._changeLocation(this.options.failUrl))}_changeButtonText(t){console.log(t),this.el.querySelector("[data-info-text]").innerText=t}_changeLocation(t){setTimeout((()=>{window.location.href=t}),1500)}_hideChangePaymentFormButton(){const t=this._getWaitingTimeFromPluginConfig(),e=Math.floor(60*t/2*1e3),i=this.el.querySelector(".change-payment-method-btn");setTimeout((()=>{i.style.display="block"}),e)}_getWaitingTimeFromPluginConfig(){const t=this.el.dataset.tpayPaymentCheckOptions;return JSON.parse(t).waitingTime}}!function(t,e,i){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(m,"options",{transactionId:"",successUrl:"",failUrl:"",checkUrl:"",waitingTime:2,waitingSuccessText:"",waitingFailText:""});const k=window.PluginManager;k.register("TpayPaymentBankSelection",d,"[data-tpay-bank-selection]"),k.register("TpayBlikMask",c,".blik--input"),k.register("TpayBlik",u.Z,"[data-tpay-blik]"),k.register("TpayPaymentCheck",m,"[data-tpay-payment-check]")},5420:(t,e,i)=>{i.d(e,{Z:()=>c});var s=i(1966),n=i(6285),o=i(9068),a=i(8254);class l{constructor(){this._httpClient=new a.Z}sendBlikTransaction(t,e){this._httpClient.post(window.router["tpay.blik-payment.register-transaction"],t,e)}sendBlikTransactionAgain(t,e){this._httpClient.post(window.router["tpay.blik-payment.register-transaction-again"],t,e)}checkPaymentState(t,e){this._httpClient.post(window.router["tpay.blik-payment.check-payment-state"],JSON.stringify({orderId:t}),e)}}var r=i(378);class d extends r.Z{_open(t){this.getModal(),this._modal.addEventListener("hidden.bs.modal",this._modalWrapper.remove),this._modal.addEventListener("shown.bs.modal",t),this._modalInstance._config.backdrop="static",this._modalInstance._config.keyboard=!1,this._modalInstance.show()}}const h=new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9][0-9]$");class c extends n.Z{init(){this.$blikButtonSubmit=this.el.querySelector(this.options.submitButtonSelector),this.$allRequiredTosPositions=document.querySelectorAll(this.options.tos.tosContainerSelector+' [required="required"]'),this.$blikCodeInput=this.el.querySelector(this.options.blikCodeInputSelector),this.$blikModal=document.querySelector(".blik--modal"),this.$isOrderCreated=!1,this._errors=[],this._blikApiClient=new l,this._registerEvents()}_registerEvents(){this.el.addEventListener("submit",this._onSubmitForm.bind(this)),this.$blikButtonSubmit.addEventListener("click",this._sendBlik.bind(this)),s.Z.iterate(this.$allRequiredTosPositions,(t=>{t.addEventListener("change",(()=>{t.checked?t.classList.remove(this.options.isInvalidClass):t.classList.add(this.options.isInvalidClass)})),t.addEventListener("invalid",(t=>{t.target.scrollIntoView({behavior:"smooth",block:"center"})}))}))}_onSubmitForm(t){t.preventDefault()}_sendBlik(){if(!this._tosValidation())return;const t=new d(this.$blikModal.outerHTML);t.open(this._onOpenBlik.bind(this)),this.$blikModal=t.getModal(),this._blikCodeValidation()?!1===this.options.changedPayment?this._blikApiClient.sendBlikTransaction(new FormData(this.el),this._handleBlikTransaction.bind(this)):this._blikApiClient.sendBlikTransactionAgain(new FormData(this.el),this._handleBlikTransaction.bind(this)):(this.$blikCodeInput.classList.add(this.options.isInvalidClass),this.$blikModal.querySelector(".blik--modal").classList.add(this.options.isInvalidClass)),this.$blikModal.classList.add(this.options.pseudoModalAdditionalClass),this.$blikModal.querySelector(".modal-dialog").classList.add("modal-dialog-centered"),this.$isOrderCreated||this.$blikModal.querySelector(this.options.modalChangeMethodButtonSelector).addEventListener("click",(()=>{t.close()}))}_onOpenBlik(){this._registerModalEvents(this.$blikModal),o.Z.initializePlugins()}_registerModalEvents(t){const e=t.querySelector(this.options.blikCodeInputSelector);t.querySelector(this.options.submitButtonSelector).addEventListener("click",(()=>{const i=t.querySelector(this.options.modalInvalidCodeSelector);if(this._blikCodeValidation(e)){e.classList.remove(this.options.isInvalidClass),this.$blikModal.querySelector(".blik--modal").classList.remove(this.options.isInvalidClass);const t=new FormData(this.el);t.set("blikCode",e.value),this._notPaidOrderId?(t.append("orderId",this._notPaidOrderId),t.append("paymentMethodId",this.options.paymentMethodId),this._blikApiClient.sendBlikTransactionAgain(t,this._handleBlikTransaction.bind(this))):this._blikApiClient.sendBlikTransaction(t,this._handleBlikTransaction.bind(this))}else e.classList.add(this.options.isInvalidClass),i.classList.add(this.options.isInvalidClass)}))}_handleBlikTransaction(t){const e=JSON.parse(t);if(e.orderId&&(this.$isOrderCreated=!0,[...this.$blikModal.querySelectorAll(this.options.modalChangeMethodButtonSelector)].forEach((t=>{t.classList.remove("d-none"),t.addEventListener("click",(()=>{window.location.replace(`/account/order/edit/${e.orderId}`)}))}))),!this._handleErrors(e))return!1;e.success&&e.orderId&&(this._finishUrl=e.finishUrl,this._orderId=e.orderId,setTimeout((()=>{this._blikApiClient.checkPaymentState(e.orderId,this._handleCheckPaymentState.bind(this))}),500))}_handleCheckPaymentState(t){const e=JSON.parse(t);if(!this._handleErrors(e))return!1;e.waiting?setTimeout((()=>{this._blikApiClient.checkPaymentState(this._orderId,this._handleCheckPaymentState.bind(this))}),500):e.success&&(this.$blikModal.classList.add("is--success"),this.$blikModal.querySelector(".blik--modal-message-success").classList.remove("is--hidden"),this.$blikModal.querySelector(".blik--modal-message-wait").classList.add("is--hidden"),setTimeout((()=>{window.location.replace(this._finishUrl)}),5e3))}_handleErrors(t){return!!t.waiting||(void 0!==t.error&&t.error.length>0?(this._errors+=t.error,!1):!(!t.success&&!t.blikCodeValid)||(this._notPaidOrderId=t.orderId,this.$blikModal.querySelector(".blik--modal").classList.add(this.options.isInvalidClass,"is-blik-invalid"),!1))}_tosValidation(){if(0===this.$allRequiredTosPositions.length)return!0;s.Z.iterate(this.$allRequiredTosPositions,(t=>{t.checked?t.classList.remove(this.options.isInvalidClass):t.classList.add(this.options.isInvalidClass)}));const t=[];return[].forEach.call(this.$allRequiredTosPositions,(e=>{e.classList.contains(this.options.isInvalidClass)&&t.push(!0)})),0===t.length}_blikCodeValidation(t){return void 0===t&&(t=this.$blikCodeInput),0===t.value.length?(t.classList.add(this.options.isInvalidClass),!1):h.test(t.value)}}var u,p,m;u=c,m={paymentMethodId:"",changedPayment:!1,blikTransactionUrl:"",blikCheckStatusUrl:"",submitButtonSelector:"#confirmFormSubmit",blikCodeInputSelector:".blik--input",pseudoModalAdditionalClass:"blik-modal",modalChangeMethodButtonSelector:".blik--modal-change-method-btn",modalInvalidCodeSelector:".blik--modal-invalid-code",modalWaitCodeSelector:".blik--modal-wait-state",modalErrorSelector:".blik--modal-error-state",modalSuccessSelector:".blik--modal-success-state",isInvalidClass:"is-invalid",tos:{tosContainerSelector:".confirm-tos"}},(p=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(p="options"))in u?Object.defineProperty(u,p,{value:m,enumerable:!0,configurable:!0,writable:!0}):u[p]=m}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=8888,t(t.s=e);var e}));t.O()}]);